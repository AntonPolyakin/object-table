"use strict";angular.module("objectTable",[]).directive("contenteditable",function(){return{restrict:"A",require:"ngModel",link:function(e,t,r,n){function a(){n.$setViewValue(t.html())}n.$render=function(){t.html(n.$viewValue||"")},t.bind("change",function(){e.$apply(a)})}}}),angular.module("objectTable").directive("objectTable",["$compile","$interpolate",function(e,t){return{restrict:"A",replace:!0,templateUrl:"/src/templates/common.html",controller:"objectTableCtrl",controllerAs:"ctrl",transclude:!0,scope:{data:"=",display:"@",pagging:"=?",fromUrl:"@",sortingType:"@?sorting",editable:"=?"},compile:function(e,t){var r="",n="";return t.addFilter&&(r+=t.addFilter),"false"!==t.sorting&&(r+="| orderBy:sortingArray"),"separate"==t.search?t.fields.split(",").forEach(function(e,t){r+="| filter:{'"+e.trim()+"':columnSearch["+t+"]}"}):("undefined"==typeof t.search||"true"==t.search)&&(r+="| filter:globalSearch"),n=r,r+=" | offset: currentPage:display |limitTo: display",e[0].querySelector("#rowTr").setAttribute("ng-repeat","item in data"+r),e.find("pagging").attr("count","(data"+n+").length"),function(e,t,n,a,i){a.init(),i(e,function(t,n){e.$owner=n.$parent;for(var i in t)t.hasOwnProperty(i)&&"THEAD"==t[i].tagName?a.addHeaderPattern(t[i]):"TBODY"==t[i].tagName&&(e.findBody=!0,a.addRowPattern(t[i],r))})}}}}]),angular.module("objectTable").controller("objectTableCtrl",["$scope","$timeout","$element","$attrs","$http","$compile","$controller",function(e,t,r,n,a,i,o,s){o("objectTableSortingCtrl",{$scope:e}),this.init=function(){if(e.headers=[],e.fields=[],e.display=e.display||5,e.pagging=angular.isDefined(e.pagging)?e.pagging:!0,e.sortingType=e.sortingType||"simple",e.currentPage=0,e.customHeader=!1,e.search="separate"!==n.search?"undefined"!=typeof n.search?JSON.parse(n.search):!0:n.search,"separate"==e.search&&(e.columnSearch=[]),!n.headers)throw"Required 'headers' attribute is not found!";if(n.headers.split(",").forEach(function(t){e.headers.push(t.trim())}),!n.fields)throw"Sorting is allowed just with specified 'fields' attribute !";n.fields.split(",").forEach(function(t){e.fields.push(t.trim())}),n.fromUrl&&e.loadExternalData(n.fromUrl)},e.loadExternalData=function(t){e.dataIsLoading=!0,a.get(t).then(function(t){e.data=t.data,e.dataIsLoading=!1})},this.addHeaderPattern=function(t){e.customHeader=!0,r.find("table").prepend(t)},this.addRowPattern=function(t,n){t=this.checkEditableContent(t);var a=angular.element(t).find("tr");a.attr("ng-repeat","item in data"+n),a.attr("ng-click","setSelected(item)"),a.attr("ng-class","{'selected-row':item.$$hashKey==data.selected.$$hashKey}"),r.find("table").append(t.outerHTML),i(r.find("table"))(e)},this.checkEditableContent=function(e){return[].forEach.call(e.querySelectorAll("[editable]"),function(e){var t=e.innerHTML.replace("::","").replace("{{","").replace("}}","");e.innerHTML="<span contentEditable ng-model='"+t+"'>"+e.innerHTML.replace("::","")+"</span>"}),e},this.setCurrentPage=function(t){e.currentPage=t},e.setSelected=function(t){e.data.selected=t}}]),angular.module("objectTable").filter("offset",function(){return function(e,t,r){if(e){t=parseInt(t,10),r=parseInt(r,10);var n=t*r;return e.slice(n,n+r)}}}),angular.module("objectTable").controller("paggingTableCtrl",["$scope","$element","$attrs",function(e,t,r){e.currentPage=0,e.prevPage=function(){e.currentPage>0&&e.currentPage--,e.setCurrentPageToTable()},e.nextPage=function(){e.currentPage<e.pageCount()&&e.currentPage++,e.setCurrentPageToTable()},e.setCurrentPageToTable=function(){e.objectTableCtrl.setCurrentPage(e.currentPage)},e.prevPageDisabled=function(){return 0===e.currentPage?"disabled":""},e.pageCount=function(){return e.count>0?Math.ceil(e.count/e.display)-1:0},e.nextPageDisabled=function(){return e.currentPage===e.pageCount()?"disabled":""},e.setPage=function(t){e.currentPage=t,e.setCurrentPageToTable()},e.range=function(){var t=e.pageCount()+1<5?e.pageCount()+1:5,r=[],n=e.currentPage;n>e.pageCount()-t&&(n=e.pageCount()-t+1);for(var a=n;n+t>a;a++)r.push(a);return r}}]),angular.module("objectTable").controller("objectTableSortingCtrl",["$scope",function(e){e.sort={fields:[],reverse:[]},e.sortingArray=[],e.sortBy=function(t){if(e.data.length){var r=e.headers[e.fields.indexOf(t)];"compound"==e.sortingType?-1==e.sort.fields.indexOf(r)?(e.sort.fields.push(r),e.sortingArray.push(t),e.sort.reverse.push(!1)):e.changeReversing(t,e.sort.fields.indexOf(r)):"simple"==e.sortingType&&(e.sort.fields=[r],e.changeReversing(t))}},e.changeReversing=function(t,r){"compound"==e.sortingType?(e.sort.reverse[r]=!e.sort.reverse[r],e.sortingArray[r]=e.sort.reverse[r]?"-"+t:t):"simple"==e.sortingType&&(e.sort.reverse[0]=!e.sort.reverse[0],e.sortingArray=e.sort.reverse[0]?[t]:["-"+t])},e.headerIsSortedClass=function(t){if(e.sortingArray.length)if("simple"==e.sortingType){if(t==e.sort.fields[0]||"-"+t==e.sort.fields[0])return e.sort.reverse[0]?"table-sort-down":"table-sort-up"}else if("compound"==e.sortingType){var r=e.sort.fields.indexOf(t);if(-1!=r)return e.sort.reverse[r]?"table-sort-down":"table-sort-up"}},e.removeSorting=function(){var t=e.sort.fields.indexOf(this.sortField);t>-1&&(e.sort.fields.splice(t,1),e.sort.reverse.splice(t,1),e.sortingArray.splice(t,1))}}]),angular.module("objectTable").directive("pagging",["$compile","$interpolate",function(e,t){return{restrict:"E",replace:!0,templateUrl:"/src/templates/pagging.html",controller:"paggingTableCtrl",require:"^objectTable",scope:{count:"=",display:"="},link:function(e,t,r,n){e.objectTableCtrl=n}}}]);
angular.module("objectTable").run(["$templateCache", function($templateCache) {$templateCache.put("templates/common.html","<div class=\"object-table-module\">\n	<div class=\"col-xs-12 col-sm-6 col-md-8 sorting-container\">\n		<div ng-if=\"sortingType && sort.fields.length\">\n			Sorting: \n			<div ng-repeat=\"sortField in sort.fields\" class=\"sorting-badge\">\n				<span class=\"glyphicon \" \n				ng-class=\"{\'glyphicon-chevron-down\':sort.reverse[$index],\n				\'glyphicon-chevron-up\':!sort.reverse[$index]}\" \n				></span> \n\n				{{::sortField}}\n				<span class=\"glyphicon glyphicon-remove close\" ng-click=\"removeSorting()\"></span> \n			</div>\n		</div>\n	</div>\n\n	<div class=\"form-group col-xs-12 col-sm-6 col-md-4\" ng-if=\"search && search!==\'separate\'\">\n		<input type=\"text\"  placeholder=\"Search\" ng-model=\"$parent.globalSearch\" class=\"row pull-right form-control search\">\n	</div>\n\n	<div class=\"clearfix\"></div>\n\n	<table class=\"table table-responsive table-bordered object-table\">\n		<thead ng-if=\"!customHeader\" >\n			<tr>\n				<th ng-repeat=\"head in headers track by $index\" \n				ng-click=\"sortBy(fields[$index])\"\n				ng-class=\"headerIsSortedClass(head)\"\n				class=\"sortable\">{{::head}}\n			</th>\n		</tr>\n	</thead>\n\n	<thead ng-if=\"!customHeader&& search===\'separate\'\" >\n		<tr>\n			<th ng-repeat=\"head in headers track by $index\">\n				<input type=\"text\" ng-model=\"columnSearch[$index]\" placeholder=\"Search {{::head}}...\" class=\"form-control\">\n			</th>\n		</tr>\n	</thead>	\n\n	<tbody ng-if=\"!findBody\">\n\n		<tr id=\"rowTr\" ng-click=\"setSelected(item)\" ng-class=\"{\'selected-row\':item.$$hashKey==data.selected.$$hashKey}\"> <!-- <= will inject ng-repeat -->\n			<!-- params: headers and fields -->\n			<td ng-if=\"!editable\" ng-repeat=\"field in fields\">{{::item[field]}}</td>\n			<td ng-if=\"editable\" editable ng-repeat=\"field in fields\">\n				<span contenteditable ng-model=\"item[field]\">{{item[field]}}</span>\n			</td>\n		</tr>\n\n	</tbody>\n</table>\n\n<div class=\"loading\" ng-show=\"dataIsLoading\">\n	<span class=\"glyphicon glyphicon-refresh glyphicon-refresh-animate\"></span> Loading Data...\n</div>\n<pagging ng-if=\"pagging\" data-display=\"display\" class=\"object-table-pagging\" ng-hide=\"dataIsLoading\"></pagging>\n\n<div class=\"clearfix\"></div>\n\n<!-- debug:\n<br>\nSort: {{sort}}\n<br>\nSorting Array: {{sortingArray}}\n<br>\ncurrent Page : {{currentPage}}\n</div> -->");
$templateCache.put("templates/pagging.html","	<div>\n		<div class=\"col-xs-9\">\n			<nav ng-hide=\"pageCount()==0\">\n				<ul class=\"pagination\">\n					<li ng-class=\"prevPageDisabled()\">\n						<a href ng-click=\"prevPage()\">« Prev</a>\n					</li>\n					<li ng-repeat=\"n in range()\"\n					ng-class=\"{active: n == currentPage}\" ng-click=\"setPage(n)\">\n					<a href=\"javascript:void(0)\">{{::n+1}}</a>\n				</li>\n				<li ng-class=\"nextPageDisabled()\">\n					<a href ng-click=\"nextPage()\">Next »</a>\n				</li>\n			</ul>\n		</nav>\n	</div>\n	<div class=\"col-xs-3\">\n		<span class=\"label label-default count\">{{count}} <span class=\"records\">records</span></span>\n	</div>\n</div>\n\n");}]);