"use strict";angular.module("objectTable",[]).directive("objectTable",["$compile","$interpolate",function(e,r){return{restrict:"A",replace:!0,templateUrl:"templates/common.html",controller:"objectTableCtrl",controllerAs:"ctrl",transclude:!0,scope:{data:"=",display:"@",pagging:"=?",fromUrl:"@",sortingType:"@?sorting"},compile:function(e,r){var t="",n="";return r.addFilter&&(t+=r.addFilter),"false"!==r.sorting&&(t+="| orderBy:sortingArray"),"separate"==r.search?r.fields.split(",").forEach(function(e,r){t+="| filter:{'"+e.trim()+"':columnSearch["+r+"]}"}):("undefined"==typeof r.search||"true"==r.search)&&(t+="| filter:globalSearch"),n=t,t+=" | offset: currentPage:display |limitTo: display",e[0].querySelector("#rowTr").setAttribute("ng-repeat","item in data"+t),e.find("pagging").attr("count","(data"+n+").length"),function(e,r,n,a,o){a.init(),o(e,function(r,n){e.$owner=n.$parent;for(var o in r)r.hasOwnProperty(o)&&"THEAD"==r[o].tagName?a.addHeaderPattern(r[o]):"TBODY"==r[o].tagName&&(e.findBody=!0,a.addRowPattern(r[o],t))})}}}}]),angular.module("objectTable").controller("objectTableCtrl",["$scope","$element","$attrs","$http","$compile","$controller",function(e,r,t,n,a,o,i){o("objectTableSortingCtrl",{$scope:e}),this.init=function(){if(e.headers=[],e.fields=[],e.display=e.display||5,e.pagging=angular.isDefined(e.pagging)?e.pagging:!0,e.sortingType=e.sortingType||"simple",e.currentPage=0,e.search="separate"!==t.search?"undefined"!=typeof t.search?JSON.parse(t.search):!0:t.search,"separate"==e.search&&(e.columnSearch=[]),t.headers&&t.headers.split(",").forEach(function(r){e.headers.push(r.trim())}),!t.fields)throw"Sorting is allowed just with specified 'fields' attribute !";t.fields.split(",").forEach(function(r){e.fields.push(r.trim())}),t.fromUrl&&e.loadExternalData(t.fromUrl)},e.loadExternalData=function(r){n.get(r).then(function(r){e.data=r.data})},this.addHeaderPattern=function(e){r.find("table").prepend(e)},this.addRowPattern=function(t,n){angular.element(t).find("tr").attr("ng-repeat","item in data"+n),r.find("table").append(t.outerHTML),a(r.find("table"))(e)},this.setCurrentPage=function(r){e.currentPage=r}}]),angular.module("objectTable").filter("offset",function(){return function(e,r,t){if(e){r=parseInt(r,10),t=parseInt(t,10);var n=r*t;return e.slice(n,n+t)}}}),angular.module("objectTable").controller("paggingTableCtrl",["$scope","$element","$attrs",function(e,r,t){e.currentPage=0,e.prevPage=function(){e.currentPage>0&&e.currentPage--,e.setCurrentPageToTable()},e.nextPage=function(){e.currentPage<e.pageCount()&&e.currentPage++,e.setCurrentPageToTable()},e.setCurrentPageToTable=function(){e.objectTableCtrl.setCurrentPage(e.currentPage)},e.prevPageDisabled=function(){return 0===e.currentPage?"disabled":""},e.pageCount=function(){return e.count>0?Math.ceil(e.count/e.display)-1:0},e.nextPageDisabled=function(){return e.currentPage===e.pageCount()?"disabled":""},e.setPage=function(r){e.currentPage=r,e.setCurrentPageToTable()},e.range=function(){var r=e.pageCount()+1<5?e.pageCount()+1:5,t=[],n=e.currentPage;n>e.pageCount()-r&&(n=e.pageCount()-r+1);for(var a=n;n+r>a;a++)t.push(a);return t}}]),angular.module("objectTable").controller("objectTableSortingCtrl",["$scope",function(e){e.sort={fields:[],reverse:[]},e.sortingArray=[],e.sortBy=function(r){if(e.data.length){var t=e.headers[e.fields.indexOf(r)];"compound"==e.sortingType?-1==e.sort.fields.indexOf(t)?(e.sort.fields.push(t),e.sortingArray.push(r),e.sort.reverse.push(!1)):e.changeReversing(r,e.sort.fields.indexOf(t)):"simple"==e.sortingType&&(e.sort.fields=[t],e.changeReversing(r))}},e.changeReversing=function(r,t){"compound"==e.sortingType?(e.sort.reverse[t]=!e.sort.reverse[t],e.sortingArray[t]=e.sort.reverse[t]?"-"+r:r):"simple"==e.sortingType&&(e.sort.reverse[0]=!e.sort.reverse[0],e.sortingArray=e.sort.reverse[0]?[r]:["-"+r])},e.headerIsSortedClass=function(r){if(e.sortingArray.length)if("simple"==e.sortingType){if(r==e.sort.fields[0]||"-"+r==e.sort.fields[0])return e.sort.reverse[0]?"table-sort-down":"table-sort-up"}else if("compound"==e.sortingType){var t=e.sort.fields.indexOf(r);if(-1!=t)return e.sort.reverse[t]?"table-sort-down":"table-sort-up"}},e.removeSorting=function(){var r=e.sort.fields.indexOf(this.sortField);r>-1&&(e.sort.fields.splice(r,1),e.sort.reverse.splice(r,1),e.sortingArray.splice(r,1))}}]),angular.module("objectTable").directive("pagging",["$compile","$interpolate",function(e,r){return{restrict:"E",replace:!0,templateUrl:"templates/pagging.html",controller:"paggingTableCtrl",require:"^objectTable",scope:{count:"=",display:"="},link:function(e,r,t,n){e.objectTableCtrl=n}}}]);
angular.module("objectTable").run(["$templateCache", function($templateCache) {$templateCache.put("templates/common.html","<div>\n\n	<div class=\"col-sm-8 sorting-container\" ng-if=\"sortingType\">\n		Sorting order: \n		<div ng-repeat=\"sortField in sort.fields\" class=\"sorting-badge\">\n			<span class=\"glyphicon \" \n			ng-class=\"{\'glyphicon-chevron-down\':sort.reverse[$index],\n			\'glyphicon-chevron-up\':!sort.reverse[$index]}\" \n			></span> \n\n			{{::sortField}}\n			<span class=\"glyphicon glyphicon-remove close\" ng-click=\"removeSorting()\"></span> \n		</div>\n	</div>\n\n	<div class=\"form-group col-sm-4\" ng-if=\"search && search!==\'separate\'\">\n		<input type=\"text\"  placeholder=\"Search\" ng-model=\"$parent.globalSearch\" class=\"pull-right form-control search\">\n	</div>\n\n	<div class=\"clearfix\"></div>\n\n	<table class=\"table table-responsive table-bordered\">\n		<thead ng-if=\"headers.length\" >\n			<tr>\n				<th ng-repeat=\"head in headers track by $index\" \n				ng-click=\"sortBy(fields[$index])\"\n				ng-class=\"headerIsSortedClass(head)\"\n				class=\"sortable\">{{::head}}\n			</th>\n			</tr>\n		</thead>\n\n		<thead ng-if=\"headers.length && search===\'separate\'\" >\n			<tr>\n				<th ng-repeat=\"head in headers track by $index\">\n				<input type=\"text\" ng-model=\"columnSearch[$index]\" placeholder=\"Search {{::head}}...\" class=\"form-control\">\n			</th>\n			</tr>\n		</thead>\n\n		<tbody ng-if=\"!findBody\">\n\n			<tr id=\"rowTr\"><!-- <= will inject ng-repeat -->\n				<!-- params: headers and all fields -->\n				<td ng-if=\"!fields.length\" ng-repeat=\"(key, prop) in item\">{{prop}}</td>\n				<!-- params: headers and fields -->\n				<td ng-if=\"fields.length\" ng-repeat=\"field in fields\">{{item[field]}}</td>\n			</tr>\n\n		</tbody>\n	</table>\n\n	<pagging ng-if=\"pagging\" data-display=\"display\"></pagging>\n\n\n<!-- debug:\n<br>\nSort: {{sort}}\n<br>\nSorting Array: {{sortingArray}}\n<br>\ncurrent Page : {{currentPage}}\n</div> -->");
$templateCache.put("templates/pagging.html","	<nav ng-hide=\"pageCount()==0\">\n		<ul class=\"pagination\">\n			<li ng-class=\"prevPageDisabled()\">\n				<a href ng-click=\"prevPage()\">« Prev</a>\n			</li>\n			<li ng-repeat=\"n in range()\"\n			ng-class=\"{active: n == currentPage}\" ng-click=\"setPage(n)\">\n			<a href=\"#\">{{::n+1}}</a>\n		</li>\n		<li ng-class=\"nextPageDisabled()\">\n			<a href ng-click=\"nextPage()\">Next »</a>\n		</li>\n	</ul>\n</nav>");}]);