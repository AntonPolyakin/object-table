/**
 * angular-object-table - angular smart table directive
 * @version v0.2.6
 * @author Yauheni Kokatau
 * @license MIT
 */
"use strict";angular.module("objectTable",[]).directive("contenteditable",function(){return{restrict:"A",require:["ngModel","^objectTable"],link:function(r,n,e,t){var a=t[0],o=t[1];a.$render=function(){n.html(a.$viewValue||"")},n.bind("change blur",function(){var e=a.$viewValue.toString(),t=n.text();e!==t&&(r.$apply(function(){a.$setViewValue(t)}),o.onEdit&&"function"==typeof o.onEdit&&o.onEdit({$oldValue:e,$newValue:t}))})}}}),angular.module("objectTable").directive("objectTable",["$compile","$interpolate",function(e,t){return{restrict:"A",replace:!0,templateUrl:"/src/templates/common.html",controller:"objectTableCtrl",controllerAs:"ctrl",transclude:!0,scope:{data:"=",display:"=?",resize:"=?",paging:"=?",fromUrl:"@",sortingType:"@?sorting",editable:"&?",select:"@?",selectedModel:"=?",dragColumns:"=?",onEdit:"&?",onDrag:"&?"},compile:function(e,t){var o="",i="";return t.addFilter&&(o+=t.addFilter),"false"!==t.sorting&&(o+="| orderBy:sortingArray"),t.dragColumns&&e.find("th").attr("allow-drag",""),"separate"===t.search?t.fields.split(",").forEach(function(e,t){o+="| filter:{'"+e.trim()+"':columnSearch['"+e+"']}"}):void 0!==t.search&&"true"!==t.search||(o+="| filter:globalSearch"),i+=" | offset: currentPage:display |limitTo: display",e[0].querySelector("#rowTr").setAttribute("ng-repeat","item in $parent.$filtered = (data"+o+")"+i),e.find("paging").attr("count","$filtered.length"),function(n,e,t,a,r){a._init(),r(n,function(e,t){for(var r in n.$owner=t.$parent,e)if(e.hasOwnProperty(r))switch(e[r].tagName){case"THEAD":a._addHeaderPattern(e[r]);break;case"TBODY":n.findBody=!0,a._addRowPattern(e[r],o,i);break;case"TFOOT":a._addFooterPattern(e[r])}})}}}}]),angular.module("objectTable").directive("allowDrag",function(){return{restrict:"A",controller:function(){},compile:function(e,t){function i(e,t){var r=e[0].parentNode.querySelector("."+t);r&&r.classList.remove(t)}return function(e,a,t,o){a.attr("draggable",!0),a.bind("dragstart",function(e){(o.target=this).classList.add("dragged"),(e.originalEvent||e).dataTransfer.setData("text",o.target.cellIndex)}),a.bind("dragover",function(e){e.preventDefault()}),a.bind("dragenter",function(e){(o.toTarget=this).classList.contains("draggedOver")||this.classList.contains("dragged")||this.classList.add("draggedOver"),e.preventDefault(),e.stopPropagation()}),a.bind("dragend",function(e){this.classList.contains("dragged")&&this.classList.remove("dragged"),e.preventDefault()}),a.bind("dragleave",function(e){this.classList.remove("draggedOver")}),a.bind("drop",function(e){var t=o.toTarget.cellIndex,r=e.originalEvent||e,n=parseInt(r.dataTransfer.getData("text"),10);i(a,"dragged"),i(a,"draggedOver"),a.parent().controller("objectTable").changeColumnsOrder(t,n),e.preventDefault()})}}}}),angular.module("objectTable").controller("objectTableCtrl",["$scope","$timeout","$element","$attrs","$http","$compile","$controller","objectTableUtilService",function(u,e,g,t,r,p,n,a){n("objectTableSortingCtrl",{$scope:u});var f=this;this._init=function(){u.headers=[],u.fields=[],u.display=u.display||5,u.paging=!angular.isDefined(u.paging)||u.paging,u.sortingType=u.sortingType||"simple",u.currentPage=0,u.customHeader=!1,"separate"==t.search?(u.search="separate",u.columnSearch=[]):u.search=void 0===t.search||"true"===t.search,u.headers=a.getArrayFromParams(t.headers,"headers"),u.fields=a.getArrayFromParams(t.fields,"fields"),t.fromUrl&&this._loadExternalData(t.fromUrl),u.onEdit&&(this.onEdit=u.onEdit),u.selectedModel="multiply"===u.select?[]:{}},this.onEdit=u.onEdit,this._loadExternalData=function(e){u.dataIsLoading=!0,r.get(e).then(function(e){u.data=e.data,u.dataIsLoading=!1})},this._addHeaderPattern=function(e){u.customHeader=!0,Array.prototype.forEach.call(e.querySelectorAll("[allow-drag]"),function(e,t){e.setAttribute("index",t)}),e.removeAttribute("ng-non-bindable"),g.find("table").prepend(e)},this._addFooterPattern=function(e){g.find("table").prepend(e)},this._addRowPattern=function(e,t,r){this._checkEditableContent(e),this._addRepeatToRow(e,t,r),e.removeAttribute("ng-non-bindable"),g.find("table").append(e.outerHTML),this.bodyTemplate=e.innerHTML,p(g.find("tbody"))(u)},this._addRepeatToRow=function(e,t,r){var n=angular.element(e).find("tr");n.attr("ng-repeat","item in $filtered = (data"+t+")"+r),n.attr("ng-click")||n.attr("ng-click","setSelected(item)"),n.attr("ng-class","{'selected-row':ifSelected(item)}")},this._checkEditableContent=function(e){var t,r=/\{\{:*:*(.*?)\}\}/g;Array.prototype.forEach.call(e.querySelectorAll("[editable]"),function(e){t=e.innerHTML.replace(r,"$1"),e.innerHTML="<div contentEditable ng-model='"+t+"'>{{"+t+"}}</div>"})},this.setCurrentPage=function(e){u.currentPage=e},u.setSelected=function(e){"multiply"===u.select?f._containsInSelectArray(e)?u.selectedModel.splice(u.selectedModel.indexOf(e),1):u.selectedModel.push(e):u.selectedModel=e},this._containsInSelectArray=function(t){if(u.selectedModel.length)return 0<u.selectedModel.filter(function(e){return angular.equals(e,t)}).length},u.ifSelected=function(e){return!!u.selectedModel&&("multiply"===u.select?f._containsInSelectArray(e):e.$$hashKey==u.selectedModel.$$hashKey)},this.changeColumnsOrder=function(c,d){u.$apply(function(){u.fields.swap(c,d);var e=u.headers.slice();if(u.headers.swap(c,d),u.onDrag&&"function"==typeof u.onDrag&&u.onDrag({$oldOrder:e,$newOrder:u.headers}),e=null,u.columnSearch&&u.columnSearch.swap(c,d),f.bodyTemplate){var t=angular.element(f.bodyTemplate).children(),r=document.createElement("tr"),n=document.createElement("tbody"),a=g.find("tbody").find("tr")[0].attributes;Array.prototype.swap.apply(t,[c,d]),[].forEach.call(a,function(e,t){r.setAttribute(e.name,e.value)});for(var o=0,i=t.length;o<i;o++)r.appendChild(t[o]);n.appendChild(r),g.find("tbody").replaceWith(n),f.bodyTemplate=n.innerHTML,p(g.find("tbody"))(u)}if(u.customHeader){var l=g.find("th"),s=(r=document.createElement("tr"),document.createElement("thead"));Array.prototype.swap.apply(l,[c,d]);for(o=0,i=l.length;o<i;o++)r.appendChild(l[o]);s.appendChild(r),g.find("thead").replaceWith(s)}f.pageCtrl&&f.pageCtrl.setPage(0)})},u.setCurrentPageForPageCtrl=function(e){f.pageCtrl&&f.pageCtrl.setPage(e)}}]),angular.module("objectTable").filter("offset",function(){return function(e,t,r){if(e){var n=(t=parseInt(t,10))*(r=parseInt(r,10));return e.slice(n,n+r)}}}),angular.module("objectTable").controller("pagingTableCtrl",["$scope","$element","$attrs",function(a,e,t){a.currentPage=0,a.prevPage=function(){0<a.currentPage&&a.currentPage--,a.setCurrentPageToTable()},a.nextPage=function(){a.currentPage<a.pageCount()&&a.currentPage++,a.setCurrentPageToTable()},a.setCurrentPageToTable=function(){a.objectTableCtrl.setCurrentPage(a.currentPage)},a.prevPageDisabled=function(){return 0===a.currentPage?"disabled":""},a.pageCount=function(){return 0<a.count?Math.ceil(a.count/a.display)-1:0},a.nextPageDisabled=function(){return a.currentPage===a.pageCount()?"disabled":""},a.setPage=function(e){a.currentPage=e,a.setCurrentPageToTable()},a.range=function(){var e=a.pageCount()+1<5?a.pageCount()+1:5,t=[],r=a.currentPage;r>a.pageCount()-e&&(r=a.pageCount()-e+1);for(var n=r;n<r+e;n++)t.push(n);return t}}]),angular.module("objectTable").controller("objectTableSortingCtrl",["$scope",function(r){r.sort={fields:[],reverse:[]},r.sortingArray=[],r.sortBy=function(e){if(l)l=!1;else if(r.data.length){var t=r.headers[r.fields.indexOf(e)];"compound"==r.sortingType?-1==r.sort.fields.indexOf(t)?(r.sort.fields.push(t),r.sortingArray.push(e),r.sort.reverse.push(!1)):r.changeReversing(e,r.sort.fields.indexOf(t)):"simple"==r.sortingType&&(r.sort.fields=[t],r.changeReversing(e))}},r.changeReversing=function(e,t){"compound"==r.sortingType?(r.sort.reverse[t]=!r.sort.reverse[t],r.sortingArray[t]=r.sort.reverse[t]?"-"+e:e):"simple"==r.sortingType&&(r.sort.reverse[0]=!r.sort.reverse[0],r.sortingArray=r.sort.reverse[0]?[e]:["-"+e])},r.headerIsSortedClass=function(e){if(r.sortingArray.length)if("simple"==r.sortingType){if(e==r.sort.fields[0]||"-"+e==r.sort.fields[0])return r.sort.reverse[0]?"table-sort-down":"table-sort-up"}else if("compound"==r.sortingType){var t=r.sort.fields.indexOf(e);if(-1!=t)return r.sort.reverse[t]?"table-sort-down":"table-sort-up"}};var n,a,o,i=!(r.removeSorting=function(){var e=r.sort.fields.indexOf(this.sortField);-1<e&&(r.sort.fields.splice(e,1),r.sort.reverse.splice(e,1),r.sortingArray.splice(e,1)),e=null}),l=!1;function s(e){i&&(n.width=o+(e.pageX-a))}r.resizeStart=function(e){var t=e.target?e.target:e.srcElement;t.classList.contains("resize")&&(n=t.parentNode,i=!0,a=e.pageX,o=t.parentNode.offsetWidth,document.addEventListener("mousemove",s),e.stopPropagation(),e.preventDefault())},r.resizeEnd=function(e){i&&(document.removeEventListener("mousemove",s),e.stopPropagation(),e.preventDefault(),l=!(i=!1))}}]),angular.module("objectTable").service("objectTableUtilService",[function(){return Array.prototype.swap=function(e,t){if(e>=this.length)for(var r=e-this.length;1+r--;)this.push(void 0);return this.splice(e,0,this.splice(t,1)[0]),this},{getArrayFromParams:function(e,t){if(!e)throw"Required '"+t+"' attribute is not found!";for(var r=[],n=e.split(","),a=0,o=n.length;a<o;a++)r.push(n[a].trim());return r}}}]),angular.module("objectTable").directive("paging",["$compile","$interpolate",function(e,t){return{restrict:"E",replace:!0,templateUrl:"/src/templates/paging.html",controller:"pagingTableCtrl",require:"^objectTable",scope:{count:"=",display:"="},link:function(e,t,r,n){e.objectTableCtrl=n,e.objectTableCtrl.pageCtrl=e}}}]);
angular.module('objectTable').run(['$templateCache', function($templateCache) {$templateCache.put('/src/templates/common.html','<div class="object-table-module"><div class="col-xs-12 col-sm-6 col-md-8 sorting-container"><div ng-if="sortingType && sort.fields.length">Sorting:<div ng-repeat="sortField in sort.fields" class="sorting-badge"><span class="glyphicon" ng-class="{\'glyphicon-chevron-down\':sort.reverse[$index], \'glyphicon-chevron-up\':!sort.reverse[$index]}"></span> {{::sortField}} <span class="glyphicon glyphicon-remove close" ng-click="removeSorting()"></span></div></div></div><div class="form-group col-xs-12 col-sm-6 col-md-4" ng-if="search && \'separate\'!=search"><input type="text" placeholder="Search" ng-model="$parent.globalSearch" class="row pull-right form-control search" ng-model-options="{ updateOn: \'default blur\', debounce: { \'default\': 500, \'blur\': 0 } }" ng-change="setCurrentPageForPageCtrl(0)"> <i class="glyphicon glyphicon-search search_icon"></i></div><div class="clearfix"></div><div class="back-cover"><table class="table table-responsive table-bordered object-table" ng-mousedown="resizeStart($event)" ng-mouseup="resizeEnd($event)"><thead ng-if="!customHeader"><tr><th ng-repeat="head in headers track by $index" ng-click="sortBy(fields[$index])" ng-class="headerIsSortedClass(head)" class="sortable">{{head}}<div ng-if="resize" class="resize"></div></th></tr></thead><thead ng-if="!customHeader&& \'separate\'===search"><tr><th ng-repeat="head in headers track by $index" class="separate"><i class="glyphicon glyphicon-search search_icon separate"></i> <input type="text" ng-model="columnSearch[fields[$index]]" placeholder="{{head}}..." class="form-control search separate" ng-model-options="{ updateOn: \'default blur\', debounce: { \'default\': 500, \'blur\': 0 } }" ng-change="setCurrentPageForPageCtrl(0)"></th></tr></thead><tbody ng-if="!findBody"><tr id="rowTr" ng-click="setSelected(item)" ng-class="{\'selected-row\':ifSelected(item)}"><!-- <= will inject ng-repeat --><!-- params: headers and fields --><td ng-if="!editable" ng-repeat="field in fields">{{item[field]}}</td><td ng-if="editable" editable ng-repeat="field in fields"><div contenteditable ng-model="item[field]">{{item[field]}}</div></td></tr></tbody></table></div><div class="loading" ng-show="dataIsLoading"><span class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span> Loading Data...</div><paging ng-if="paging" data-display="display" count="$filtered.length" class="object-table-paging" ng-hide="dataIsLoading"></paging><div class="clearfix"></div></div>');
$templateCache.put('/src/templates/paging.html','<div><div class="col-xs-9"><nav ng-hide="pageCount()==0"><ul class="pagination"><li ng-class="prevPageDisabled()"><a href ng-click="prevPage()">\xAB Prev</a></li><li ng-repeat="n in range()" ng-class="{active: n == currentPage}" ng-click="setPage(n)"><a href="javascript:void(0)">{{::n+1}}</a></li><li ng-class="nextPageDisabled()"><a href ng-click="nextPage()">Next \xBB</a></li></ul></nav></div><div class="col-xs-3"><span class="label label-default count">{{count}} <span class="records">records</span></span></div></div>');}]);